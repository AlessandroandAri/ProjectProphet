---
title: "Untitled"
author: "Skripsi"
date: '2022-11-14'
output: html_document
---

```{r}
dataispu <- read.csv("Data/dataspku.csv")
```

```{r}
library (dplyr)
library (ggplot2)
library (caTools)
library (lubridate)
library(ggplot2)
library(caret)
library(summarytools)
library(tidyverse)
library(tseries)
library (prophet)
library (e1071)
library(devtools)
library(Metrics)
```

```{r}
dataispu = dataispu[,-1]
```

```{r}
summary(dataispu)
```

#menampilkan data sebelum variabel tipe data diubah

```{r}
glimpse(dataispu)
```

#mengubah tipe data variabel

```{r}
dataispu_ <- dataispu %>% 
  mutate(Tanggal=ymd(Tanggal)) %>% 
  arrange(Tanggal)
```

#mengubah tipe data character menjadi numeric

```{r}
dataispu_$pm10<-as.numeric(dataispu_$pm10)
dataispu_$so2<-as.numeric(dataispu_$so2)
dataispu_$co<-as.numeric(dataispu_$co)
dataispu_$o3<-as.numeric(dataispu_$o3)
dataispu_$no2<-as.numeric(dataispu_$no2)
```

```{r}
glimpse(dataispu_)
```

#membersihkan data NA

```{r}
colSums(is.na(dataispu_))
```

#menghapus baris kosong NA

```{r}
Cleandata <- na.omit(dataispu_)
```

```{r}
summary(Cleandata)
```

#Explore Data Analisis (EDA)

## a. menampilkan Dataset

```{r}
datafinal <- select(Cleandata,-9)
glimpse(datafinal)
```

#menampilkan hasil statistik deskriptif

```{r}
descr(datafinal)
```

## C. Visualisasi Tingkat Partikel per Hari

### -Jumlah Partikel PM10

```{r}
pm10 <- datafinal %>% 
  ggplot(aes(x = Tanggal, y = pm10)) +
  geom_point(color = "tomato3", group=1) + 
  labs( 
    title = "Jumlah PM10 per Hari", 
    subtitle = "ISPU Jakarta", 
    x = "Tahun", 
    y = "Jumlah" 
  ) +
  theme_minimal()
pm10
```

```{r}
ggplot(data = datafinal, aes(x = Tanggal, y = pm10, color = Kategori)) +
  geom_line() +
  labs(title = "Jumlah PM10 Berdasarkan Kategori", 
       x = "Tanggal", 
       y = "Partikel PM10 (μg/m3)") +
  scale_color_manual(values = c("#0e8eff", "#0e0700", "#d19f00", "#fff80e"), 
                     labels = c("Baik", "Sangat Tidak Sehat", "Sedang", "Tidak Sehat")) +
  annotate("text", 
           x = max(datafinal$Tanggal), 
           y = mean(datafinal$pm10), label = "PM10") +
  theme_minimal()
```

### -Jumlah Partikel CO

```{r}
co <- datafinal %>% 
  ggplot(aes(x = Tanggal, y = co)) +
  geom_point(color = "orange", group=1) + 
  labs( 
    title = "Jumlah CO per Hari", 
    subtitle = "ISPU Jakarta", 
    x = "Tahun", 
    y = "Jumlah" 
  ) +
  theme_minimal()
co
```

```{r}
ggplot(data = datafinal, aes(x = Tanggal, y = co, color = Kategori)) +
  geom_line() +
  labs(title = "Jumlah CO Berdasarkan Kategori", 
       x = "Tanggal", 
       y = "Partikel CO (μg/m3)") +
  scale_color_manual(values = c("#0e8eff", "#0e0700", "#d19f00", "#fff80e"), 
                     labels = c("Baik", "Sangat Tidak Sehat", "Sedang", "Tidak Sehat")) +
  annotate("text", 
           x = max(datafinal$Tanggal), 
           y = mean(datafinal$co), label = "CO") +
  theme_minimal()
```

### - Jumlah Partikel N02

```{r}
no2 <- datafinal %>% 
  ggplot(aes(x = Tanggal, y = no2)) +
  geom_point(color = "Red", group=1) + 
  labs( 
    title = "Jumlah NO2 per Hari", 
    subtitle = "ISPU Jakarta", 
    x = "Tahun", 
    y = "Jumlah" 
  ) +
  theme_minimal()
no2
```

```{r}
ggplot(data = datafinal, aes(x = Tanggal, y = no2, color = Kategori)) +
  geom_line() +
  labs(title = "Jumlah NO2 Berdasarkan Kategori", 
       x = "Tanggal", 
       y = "Partikel NO2 (μg/m3)") +
  scale_color_manual(values = c("#0e8eff", "#0e0700", "#d19f00", "#fff80e"), 
                     labels = c("Baik", "Sangat Tidak Sehat", "Sedang", "Tidak Sehat")) +
  annotate("text", 
           x = max(datafinal$Tanggal), 
           y = mean(datafinal$no2), label = "NO2") +
  theme_minimal()
```

### -Jumlah Partikel S02

```{r}
so2 <- datafinal %>% 
  ggplot(aes(x = Tanggal, y = so2)) +
  geom_point(color = "tomato2", group=1) + 
  labs( 
    title = "Jumlah SO2 per Hari", 
    subtitle = "ISPU Jakarta", 
    x = "Tahun", 
    y = "Jumlah" 
  ) +
  theme_minimal()
so2
```

```{r}
ggplot(data = datafinal, aes(x = Tanggal, y = so2, color = Kategori)) +
  geom_line() +
  labs(title = "Jumlah SO2 Berdasarkan Kategori", 
       x = "Tanggal", 
       y = "Partikel SO2 (μg/m3)") +
  scale_color_manual(values = c("#0e8eff", "#0e0700", "#d19f00", "#fff80e"), 
                     labels = c("Baik", "Sangat Tidak Sehat", "Sedang", "Tidak Sehat")) +
  annotate("text", 
           x = max(datafinal$Tanggal), 
           y = mean(datafinal$so2), label = "SO2") +
  theme_minimal()
```

### - Jumlah Partikel 03

```{r}
o3 <- datafinal %>% 
  ggplot(aes(x = Tanggal, y = o3)) +
  geom_point(color = "blue", group=1) + 
  labs( 
    title = "Jumlah O3 per Hari", 
    subtitle = "ISPU Jakarta", 
    x = "Tahun", 
    y = "Jumlah" 
  ) +
  theme_minimal()
o3
```

```{r}
ggplot(data = datafinal, aes(x = Tanggal, y = o3, color = Kategori)) +
  geom_line() +
  labs(title = "Jumlah O3 Berdasarkan Kategori", 
       x = "Tanggal", 
       y = "Partikel O3 (μg/m3)") +
  scale_color_manual(values = c("#0e8eff", "#0e0700", "#d19f00", "#fff80e"), 
                     labels = c("Baik", "Sangat Tidak Sehat", "Sedang", "Tidak Sehat")) +
  annotate("text", 
           x = max(datafinal$Tanggal), 
           y = mean(datafinal$o3), label = "O3") +
  theme_minimal()
```

## D. Menghitung Total Partikel Polusi Udara Per Bulan

### - Total PM10 dan Visualisasi Jumlah PM10 per Bulan

```{r}
pm10tot <- datafinal %>% 
  mutate(first_date_month = floor_date(Tanggal, unit = "month")) %>% 
  group_by(first_date_month) %>% 
  summarise(jumlahPM10 = sum (pm10))
pm10tot
```

```{r}
ggplot(data = pm10tot, aes(x = first_date_month, y = jumlahPM10, color = "PM10")) +
geom_line() +
labs(title = "Jumlah PM10 per Bulan",
x = "",
y = "Jumlah PM10 (μg/m3)") +
theme_minimal() +
scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
scale_color_manual(values = c("#0e8eff"), labels = c("PM10"))
```

### - Total CO dan Visualisasi Jumlah CO per Bulan

```{r}
cotot <- datafinal %>% 
  mutate(first_date_month = floor_date(Tanggal, unit = "month")) %>% 
  group_by(first_date_month) %>% 
  summarise(jumlah_CO = sum (co))
cotot
```

```{r}
ggplot(data = cotot, aes(x = first_date_month, y = jumlah_CO, color = "CO")) +
geom_line() +
labs(title = "Jumlah CO per Bulan",
x = "",
y = "Jumlah CO (μg/m3)") +
theme_minimal() +
scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
scale_color_manual(values = c("#0e0700"), labels = c("CO"))
```

### - Total O3 dan Visualisasi Jumlah O3 per Bulan

```{r}
o3tot <- datafinal %>% 
  mutate(first_date_month = floor_date(Tanggal, unit = "month")) %>% 
  group_by(first_date_month) %>% 
  summarise(jumlahO3 = sum (o3))
o3tot
```

```{r}
ggplot(data = o3tot, aes(x = first_date_month, y = jumlahO3, color = "O3")) +
geom_line() +
labs(title = "Jumlah O3 per Bulan",
x = "",
y = "Jumlah O3 (μg/m3)") +
theme_minimal() +
scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
scale_color_manual(values = c("#d19f00"), labels = c("O3"))
```

### - Total NO2 dan Visualiasi Jumlah NO2 per Bulan

```{r}
no2tot <- datafinal %>% 
  mutate(first_date_month = floor_date(Tanggal, unit = "month")) %>% 
  group_by(first_date_month) %>% 
  summarise(jumlahNO2 = sum (no2))
no2tot
```

```{r}
ggplot(data = no2tot, aes(x = first_date_month, y = jumlahNO2, color = "NO2")) +
geom_line() +
labs(title = "Jumlah NO2 per Bulan",
x = "",
y = "Jumlah NO2 (μg/m3)") +
theme_minimal() +
scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
scale_color_manual(values = c("#30e97f"), labels = c("NO2"))
```

### - Total SO2 dan Visualisasi Jumlah SO2 per Bulan

```{r}
so2tot <- datafinal %>% 
  mutate(first_date_month = floor_date(Tanggal, unit = "month")) %>% 
  group_by(first_date_month) %>% 
  summarise(jumlahSO2 = sum (so2))
so2tot
```

```{r}
ggplot(data = so2tot, aes(x = first_date_month, y = jumlahSO2, color = "SO2")) +
geom_line() +
labs(title = "Jumlah SO2 per Bulan",
x = "",
y = "Jumlah SO2 (μg/m3)") +
theme_minimal() +
scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
scale_color_manual(values = c("blue"), labels = c("SO2"))
```

### - Visualisasi Jumlah PM10, NO2, O3, SO2, dan CO per Bulan

```{r}
ggplot(data = pm10tot, aes(x = first_date_month, y = jumlahPM10, color = "PM10")) +
geom_line() +
geom_line(data = cotot, aes(x = first_date_month, y = jumlah_CO, color = "CO")) +
geom_line(data = o3tot, aes(x = first_date_month, y = jumlahO3, color = "O3")) +
geom_line(data = so2tot, aes(x = first_date_month, y = jumlahSO2, color = "SO2")) +
geom_line(data = no2tot, aes(x = first_date_month, y = jumlahNO2, color = "NO2")) +
labs(title = "Jumlah Partikel Polusi Udara per Bulan",
x = "Tahun",
y = "Jumlah Partikel (μg/m3)", 
subtitle = "Data terakhir 31 Desember 2021") +
theme_minimal() +
scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
scale_color_manual(values = c("#0e8eff", "#0e0700", "#d19f00", "#fff80e", "#30e97f"),
labels = c("PM10", "CO", "O3","SO2", "NO2")) +
theme(legend.position = "bottom")
```

Berdasarkan Gambar diatas bisa dilihat bahwa, rata-rata tingkat O3 dan SO2 relatif lebih tinggi dibandingkan dengan 3 partikel yang lainnya.

# 5. Model

## A. Model Prophet

### 1. Membagi Data menjadi data latih dan data uji

```{r}
# membagi data berdasarkan variabel SO2
train_data_index <- createDataPartition(datafinal$so2, p=0.7, list = FALSE)
train_data <- datafinal[train_data_index,]
test_data <- datafinal[-train_data_index,]
```

```{r}
dim(train_data)
dim(test_data)
```

```{r}
head(train_data)
head(test_data)
```

```{r}
qplot(Tanggal, so2, data = train_data,
      main = "Tingkat Polusi Partikel SO2")
```

```{r}
qplot(Tanggal, so2, data = test_data,
      main = "Tingkat Polusi Partikel SO2")
```
### 2. Hasil Prediksi Berdasarkan Variabel SO2
## a. Mengelompokkan dan Menyiapkan data latih berdasarkan Variabel SO2

```{r}
daily_so2 <- train_data %>% 
  group_by(Tanggal) %>% 
  summarise( 
    jum_so2=sum(so2)
  )  
daily_so2
``` 

```{r}
# Merubah format data kedalam ds dan y
train_daily_so2 <- daily_so2 %>% 
  rename(
    ds = "Tanggal",
    y = "jum_so2"
    )
glimpse(train_daily_so2)
```

## b. Membuat Model Prophet

```{r}
prophet_ts <- prophet(daily.seasonality = TRUE, seasonality_prior_scale=0.1) %>% 
  fit.prophet(train_daily_so2)
#prophet_ts
```

## c. Melakukan Prediksi untuk 2 Tahun ke depan

```{r}
future_prophet_ts <- make_future_dataframe(prophet_ts, periods = 365*2, freq = "day")
glimpse(future_prophet_ts)
```

## d. Menampilkan hasil prediksi

```{r}
# visualisasi hasil forecasting
forecast_ts <- predict(prophet_ts, future_prophet_ts)
plot(prophet_ts, forecast_ts)
```

## e. Menampilkan hasil prediksi berdasarkan komponen

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(prophet_ts, forecast_ts) 
```

Berdasarkan gambar diatas bisa dilihat bahwa, tingkat partikel SO2 untuk 2 tahun kedepan trennya mengalami peningkatan. Setiap tahun bisa dilihat ada peningkatan SO2 yang paling tinggi adalah di bulan Oktober s/d Desember.

## f. Forecast berdasarkan seasonality bulan

```{r}
# forecast berdasarkan seasionality month (bulan)
model_ts_monthly <- prophet(changepoint.prior.scale = 0.05, 
                    yearly.seasonality = FALSE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 3) %>% 
  fit.prophet(train_daily_so2) 
future_ts_monthly <- make_future_dataframe(model_ts_monthly, periods = 365) 
forecast_ts_monthly <- predict(model_ts_monthly, future_ts_monthly) 
prophet_plot_components(model_ts_monthly, forecast_ts_monthly)
```

## g. Visualisasi Tren Peningkatan Partikel SO2

```{r}
plot(model_ts_monthly, forecast_ts_monthly)
```

Berdasarkan gambar tersebut bisa dilihat bahwa ada tren peningkatan jumlah partikel SO2 dibandingkan tahun sebelumnya

## h. forecast berdasarkan seasionality penambahan holiday (hari libur)

```{r}
# Menetapkan hari libur mulai dari tahun 2016 sampai 2021, misal libur di hari natal 25 desember atau tahun baru setiap tanggal 31 desember
holiday <- 
  data.frame( 
    holiday = "newyeareve", 
    ds = dmy(c("31-12-2016","31-12-2017", "31-12-2018", "31-12-2019", "31-12-2020", "31-12-2021")), 
    lower_window = -6, 
    upper_window = 0 
  ) 
holiday 
```

```{r}
# visualisasi hasil forecast dengan penambahan efek holiday
model_ts_holiday <- prophet(changepoint.prior.scale = 0.05, 
                    holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5) %>% 
  fit.prophet(train_daily_so2) 
future_ts_holiday <- make_future_dataframe(model_ts_holiday, periods = 365*5) 
forecast_ts_holiday <- predict(model_ts_holiday, future_ts_holiday) 
plot(model_ts_holiday, forecast_ts_holiday)
```

```{r}
# Melihat trend holiday effect dari perkiraan
prophet_plot_components(model_ts_holiday, forecast_ts_holiday)
```

## i. Melihat hasil perkiraan berdasarkan trend dan seonality

```{r}
forecast_ts %>%
  select(ds, trend, weekly, yearly, yhat)
```

## j. Model fine Tuning untuk melihat trend liner dari permintaan

Ini digunakan untuk melihat trend perkiraan dengan bentuk lain yaitu dengan menambahkan changepoint

```{r}
plot(prophet_ts, forecast_ts) + 
  add_changepoints_to_plot(prophet_ts, threshold = 0) 
```

## k. Menyiapkan data Test

```{r}
daily_so2_test <- test_data %>% 
  group_by(Tanggal) %>% 
  summarise( 
    jum_so2=sum(so2)
  )  
daily_so2_test
```

```{r}
# Merubah format data kedalam ds dan y
test_daily_so2 <- daily_so2_test %>% 
  rename(
    ds = "Tanggal",
    y = "jum_so2"
    )
glimpse(test_daily_so2)
```

## l. Model Final

```{r}
# Menyiapkan model final
final_model <- prophet(changepoint.prior.scale = 0.05, 
                       yearly.seasonality = TRUE, 
                       holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5)  %>% 
  fit.prophet(train_daily_so2) 
future_final <- make_future_dataframe(model_final, periods = nrow(test_daily_so2) + 1) 
forecast_final <- predict(final_model, future_final) 
plot(final_model, forecast_final)
```

## m. Melakukan Prediksi dengan Data Uji

```{r}
# membuat prediksi untuk data uji
prediction_test <- predict(model_final, test_daily_so2)
```

```{r}
# menampilkan hasil prediksi
plot(model_final, prediction_test)
```

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(model_final, prediction_test)
```

```{r}
plot(model_final, forecast_final) + 
  geom_point(data = test_daily_so2 %>% 
               mutate(ds = as.POSIXct(ds)), aes(x=ds, y=y), color="tomato3")
```

Berdasarkan hasil diatas bisa disimpulkan bahwa model dapat memprediksi data uji dengan baik dan memperlihatkan bahwa prediksi untuk partikel SO2 pada data uji juga trennya meningkat. Sehingga bisa dipastikan bahwa hasil prediksi model pada data latih sama dengan hasil prediksi pada data uji. Untuk memberikan gambaran seberapa baik model dan seberapa akurat hasil prediksi maka akan dilakukan evaluasi dengan beberapa matrik evaluasi yaitu: MSE, RSME, MAE, dan MAPE.

## n. Evaluasi Model (Model Performance)

```{r}
# Mean squared error (MSE)
MSEProphet <- mean((test_daily_so2$y - prediction_test$yhat)^2)
MSEProphet
```

```{r}
# Root mean squared error (RMSE)
RMSEProphet <- sqrt(MSEProphet)
RMSEProphet
```

```{r}
# Mean absolute error (MAE)
MAEProphet <- mean(abs(test_daily_so2$y - prediction_test$yhat))
MAEProphet
```

```{r}
# Mean absolute percentage error (MAPE)
MAPEProphet <- mean(abs(test_daily_so2$y - prediction_test$yhat) / test_daily_so2$y)
MAPEProphet
```


### 2. Hasil Prediksi Berdasarkan Variabel PM10
## a. Membagi Data menjadi data latih dan data uji
```{r}
# membagi data berdasarkan variabel PM10
train_data_index2 <- createDataPartition(datafinal$pm10, p=0.7, list = FALSE)
train_datapm10 <- datafinal[train_data_index2,]
test_datapm10 <- datafinal[-train_data_index2,]
```

```{r}
dim(train_datapm10)
dim(test_datapm10)
```

```{r}
head(train_datapm10)
head(test_datapm10)
```

```{r}
qplot(Tanggal, pm10, data = train_datapm10,
      main = "Tingkat Polusi Partikel PM10 Data Latih")
```

```{r}
qplot(Tanggal, pm10, data = test_datapm10,
      main = "Tingkat Polusi Partikel PM10 Uji")
```
## b. Mengelompokkan dan Menyiapkan data latih berdasarkan Variabel PM10
```{r}
daily_pm10 <- train_datapm10 %>% 
  group_by(Tanggal) %>% 
  summarise( 
    tot_pm10=sum(pm10)
  )  
daily_pm10
```

```{r}
# Merubah format data kedalam ds dan y
train_daily_pm10 <- daily_pm10 %>% 
  rename(
    ds = "Tanggal",
    y = "tot_pm10"
    )
glimpse(train_daily_pm10)
```
## c. Membuat Model Prophet

```{r}
prophet_pm10 <- prophet(daily.seasonality = TRUE, seasonality_prior_scale=0.1) %>% 
  fit.prophet(train_daily_pm10)
#prophet_pm10
```

## d. Melakukan Prediksi untuk 2 Tahun ke depan

```{r}
future_prophet_pm10 <- make_future_dataframe(prophet_pm10, periods = 365*2, freq = "day")
glimpse(future_prophet_pm10)
```

## e. Menampilkan hasil prediksi

```{r}
# visualisasi hasil forecasting
forecast_pm10 <- predict(prophet_pm10, future_prophet_pm10)
plot(prophet_pm10, forecast_pm10)
```

## f. Menampilkan hasil prediksi berdasarkan komponen

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(prophet_pm10, forecast_pm10) 
```

Berdasarkan gambar diatas bisa dilihat pada trend menunjukkan bahwa prediksi tingkat PM10 untuk 2 tahun mengalami penurunan. Setiap tahun dapat dilihat ada peningkatan PM10 yang paling tinggi ada di bulan Juli s/d Agustus.

## g. Forecast berdasarkan seasonality bulan

```{r}
# forecast berdasarkan seasionality month (bulan)
model_pm10_monthly <- prophet(changepoint.prior.scale = 0.05, 
                    yearly.seasonality = FALSE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 3) %>% 
  fit.prophet(train_daily_pm10) 
future_pm10_monthly <- make_future_dataframe(model_pm10_monthly, periods = 365) 
forecast_pm10_monthly <- predict(model_pm10_monthly, future_pm10_monthly) 
prophet_plot_components(model_pm10_monthly, forecast_pm10_monthly)
```

## h. Visualisasi Tren Peningkatan Partikel PM10

```{r}
plot(model_pm10_monthly, forecast_pm10_monthly)
```

Berdasarkan gambar tersebut dapat dillihat bahwa tingkat PM10 selama 5 tahun cukup stabil dari tahun sebelum diprediksi.
## i. forecast berdasarkan seasionality penambahan holiday (hari libur)

```{r}
# Menetapkan hari libur mulai dari tahun 2016 sampai 2021, misal libur di hari natal 25 desember atau tahun baru setiap tanggal 31 desember
holiday <- 
  data.frame( 
    holiday = "newyeareve", 
    ds = dmy(c("31-12-2016","31-12-2017", "31-12-2018", "31-12-2019", "31-12-2020", "31-12-2021")), 
    lower_window = -6, 
    upper_window = 0 
  ) 
holiday 
```

```{r}
# visualisasi hasil forecast dengan penambahan efek holiday
model_pm10_holiday <- prophet(changepoint.prior.scale = 0.05, 
                    holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5) %>% 
  fit.prophet(train_daily_pm10) 
future_pm10_holiday <- make_future_dataframe(model_pm10_holiday, periods = 365*5) 
forecast_pm10_holiday <- predict(model_pm10_holiday, future_pm10_holiday) 
plot(model_pm10_holiday, forecast_pm10_holiday)
```

```{r}
# Melihat trend holiday effect dari perkiraan
prophet_plot_components(model_pm10_holiday, forecast_pm10_holiday)
```

## j. Melihat hasil perkiraan berdasarkan trend dan seonality

```{r}
forecast_pm10 %>%
  select(ds, trend, weekly, yearly, yhat)
```

## k. Model fine Tuning untuk melihat trend liner dari permintaan

Ini digunakan untuk melihat trend perkiraan dengan bentuk lain yaitu dengan menambahkan changepoint

```{r}
plot(prophet_pm10, forecast_pm10) + 
  add_changepoints_to_plot(prophet_pm10, threshold = 0) 
```

## l. Menyiapkan data Test

```{r}
daily_pm10_test <- test_datapm10 %>% 
  group_by(Tanggal) %>% 
  summarise( 
    tot_pm10=sum(pm10)
  )  
daily_pm10_test
```

```{r}
# Merubah format data kedalam ds dan y
test_daily_pm10 <- daily_pm10_test %>% 
  rename(
    ds = "Tanggal",
    y = "tot_pm10"
    )
glimpse(test_daily_pm10)
```

## m. Model Final

```{r}
# Menyiapkan model final
final_modelpm10 <- prophet(changepoint.prior.scale = 0.05, 
                       yearly.seasonality = TRUE, 
                       holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5)  %>% 
  fit.prophet(train_daily_pm10) 
future_finalpm10 <- make_future_dataframe(final_modelpm10, periods = nrow(test_daily_pm10) + 1) 
forecast_finalpm10 <- predict(final_modelpm10, future_finalpm10) 
plot(final_modelpm10, forecast_finalpm10)
```

## n. Melakukan Prediksi dengan Data Uji

```{r}
# membuat prediksi untuk data uji
prediction_testpm10 <- predict(final_modelpm10, test_daily_pm10)
```

```{r}
# menampilkan hasil prediksi
plot(final_modelpm10, prediction_testpm10)
```

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(final_modelpm10, prediction_testpm10)
```

```{r}
plot(final_modelpm10, forecast_finalpm10) + 
  geom_point(data = test_daily_pm10 %>% 
               mutate(ds = as.POSIXct(ds)), aes(x=ds, y=y), color="tomato3")
```

Berdasarkan hasil diatas bisa disimpulkan bahwa model dapat memprediksi data uji dengan baik dan memperlihatkan bahwa prediksi untuk partikel PM10 pada data uji juga trennya meningkat. Sehingga bisa dipastikan bahwa hasil prediksi model pada data latih sama dengan hasil prediksi pada data uji. Untuk memberikan gambaran seberapa baik model dan seberapa akurat hasil prediksi maka akan dilakukan evaluasi dengan beberapa matrik evaluasi yaitu: MSE, RSME, MAE, dan MAPE.

## n. Evaluasi Model (Model Performance)

```{r}
# Mean squared error (MSE)
MSEProphet1 <- mean((test_daily_pm10$y - prediction_testpm10$yhat)^2)
MSEProphet1
```

```{r}
# Root mean squared error (RMSE)
RMSEProphet1 <- sqrt(MSEProphet1)
RMSEProphet1
```

```{r}
# Mean absolute error (MAE)
MAEProphet1 <- mean(abs(test_daily_pm10$y - prediction_testpm10$yhat))
MAEProphet1
```

```{r}
# Mean absolute percentage error (MAPE)
MAPEProphet1 <- mean(abs(test_daily_pm10$y - prediction_testpm10$yhat) / test_daily_pm10$y)
MAPEProphet1
```

### 3. Hasil Prediksi Berdasarkan Variabel NO2
## a. Membagi Data menjadi data latih dan data uji
```{r}
# membagi data berdasarkan variabel PM10
train_data_index3 <- createDataPartition(datafinal$no2, p=0.7, list = FALSE)
train_data_no2 <- datafinal[train_data_index3,]
test_data_no2 <- datafinal[-train_data_index3,]
```

```{r}
dim(train_data_no2)
dim(test_data_no2)
```

```{r}
head(train_data_no2)
head(test_data_no2)
```

```{r}
qplot(Tanggal, no2, data = train_data_no2,
      main = "Tingkat Polusi Partikel NO2 Data Latih")
```

```{r}
qplot(Tanggal, no2, data = test_data_no2,
      main = "Tingkat Polusi Partikel NO2 Uji")
```
## b. Mengelompokkan dan Menyiapkan data latih berdasarkan Variabel NO2
```{r}
daily_no2 <- train_data_no2%>% 
  group_by(Tanggal) %>% 
  summarise( 
    tot_no2=sum(no2)
  )  
daily_no2
```

```{r}
# Merubah format data kedalam ds dan y
train_daily_no2 <- daily_no2 %>% 
  rename(
    ds = "Tanggal",
    y = "tot_no2"
    )
glimpse(train_daily_no2)
```
## c. Membuat Model Prophet

```{r}
prophet_no2 <- prophet(daily.seasonality = TRUE, seasonality_prior_scale=0.1) %>% 
  fit.prophet(train_daily_no2)
#prophet_no2
```

## d. Melakukan Prediksi untuk 2 Tahun ke depan

```{r}
future_prophet_no2<- make_future_dataframe(prophet_no2, periods = 365*2, freq = "day")
glimpse(future_prophet_no2)
```

## e. Menampilkan hasil prediksi

```{r}
# visualisasi hasil forecasting
forecast_no2 <- predict(prophet_no2, future_prophet_no2)
plot(prophet_no2, forecast_no2)
```

## f. Menampilkan hasil prediksi berdasarkan komponen

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(prophet_no2, forecast_no2) 
```

Berdasarkan gambar diatas dapat dilihat trend menunjukkan bahwa prediksi tingkat NO2 untuk 2 tahun mengalami penurunan sedikit demi sedikit setiap tahunnya. Setiap tahun dapat dilihat ada peningkatan NO2 yang paling tinggi ada di bulan Oktober s/d November.

## g. Forecast berdasarkan seasonality bulan

```{r}
# forecast berdasarkan seasionality month (bulan)
model_no2_monthly <- prophet(changepoint.prior.scale = 0.05, 
                    yearly.seasonality = FALSE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 3) %>% 
  fit.prophet(train_daily_no2) 
future_no2_monthly <- make_future_dataframe(model_no2_monthly, periods = 365) 
forecast_no2_monthly <- predict(model_no2_monthly, future_no2_monthly) 
prophet_plot_components(model_no2_monthly, forecast_no2_monthly)
```

## h. Visualisasi Tren Peningkatan Partikel PM10

```{r}
plot(model_no2_monthly, forecast_no2_monthly)
```

Berdasarkan gambar tersebut dapat dillihat bahwa tingkat NO2 selama 5 tahun terus menurun setiap tahunnnya dari tahun 2022 s/d 2027.

## i. forecast berdasarkan seasionality penambahan holiday (hari libur)

```{r}
# Menetapkan hari libur mulai dari tahun 2016 sampai 2021, misal libur di hari natal 25 desember atau tahun baru setiap tanggal 31 desember
holiday <- 
  data.frame( 
    holiday = "newyeareve", 
    ds = dmy(c("31-12-2016","31-12-2017", "31-12-2018", "31-12-2019", "31-12-2020", "31-12-2021")), 
    lower_window = -6, 
    upper_window = 0 
  ) 
holiday 
```

```{r}
# visualisasi hasil forecast dengan penambahan efek holiday
model_no2_holiday <- prophet(changepoint.prior.scale = 0.05, 
                    holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5) %>% 
  fit.prophet(train_daily_no2) 
future_no2_holiday <- make_future_dataframe(model_no2_holiday, periods = 365*5) 
forecast_no2_holiday <- predict(model_no2_holiday, future_no2_holiday) 
plot(model_no2_holiday, forecast_no2_holiday)
```

```{r}
# Melihat trend holiday effect dari perkiraan
prophet_plot_components(model_no2_holiday, forecast_no2_holiday)
```

## j. Melihat hasil perkiraan berdasarkan trend dan seonality

```{r}
forecast_no2 %>%
  select(ds, trend, weekly, yearly, yhat)
```

## k. Model fine Tuning untuk melihat trend liner dari permintaan

Ini digunakan untuk melihat trend perkiraan dengan bentuk lain yaitu dengan menambahkan changepoint

```{r}
plot(prophet_no2, forecast_no2) + 
  add_changepoints_to_plot(prophet_no2, threshold = 0) 
```

## l. Menyiapkan data Test

```{r}
daily_no2_test <- test_data_no2 %>% 
  group_by(Tanggal) %>% 
  summarise( 
    tot_no2=sum(no2)
  )  
daily_no2_test
```

```{r}
# Merubah format data kedalam ds dan y
test_daily_no2 <- daily_no2_test %>% 
  rename(
    ds = "Tanggal",
    y = "tot_no2"
    )
glimpse(test_daily_no2)
```

## m. Model Final

```{r}
# Menyiapkan model final
final_model_no2 <- prophet(changepoint.prior.scale = 0.05, 
                       yearly.seasonality = TRUE, 
                       holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5)  %>% 
  fit.prophet(train_daily_no2) 
future_final_no2 <- make_future_dataframe(final_model_no2, periods = nrow(test_daily_no2) + 1) 
forecast_final_no2 <- predict(final_model_no2, future_final_no2) 
plot(final_model_no2, forecast_final_no2)
```

## n. Melakukan Prediksi dengan Data Uji

```{r}
# membuat prediksi untuk data uji
prediction_test_no2 <- predict(final_model_no2, test_daily_no2)
```

```{r}
# menampilkan hasil prediksi
plot(final_model_no2, prediction_test_no2)
```

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(final_model_no2, prediction_test_no2)
```

```{r}
plot(final_model_no2, forecast_final_no2) + 
  geom_point(data = test_daily_no2 %>% 
               mutate(ds = as.POSIXct(ds)), aes(x=ds, y=y), color="tomato3")
```

Berdasarkan hasil diatas bisa disimpulkan bahwa model dapat memprediksi data uji dengan baik dan memperlihatkan bahwa prediksi untuk partikel NO2 pada data uji juga trennya menurun. Sehingga bisa dipastikan bahwa hasil prediksi model pada data latih sama dengan hasil prediksi pada data uji. Untuk memberikan gambaran seberapa baik model dan seberapa akurat hasil prediksi maka akan dilakukan evaluasi dengan beberapa matrik evaluasi yaitu: MSE, RSME, MAE, dan MAPE.

## n. Evaluasi Model (Model Performance)

```{r}
# Mean squared error (MSE)
MSEProphet2 <- mean((test_daily_no2$y - prediction_test_no2$yhat)^2)
MSEProphet2
```

```{r}
# Root mean squared error (RMSE)
RMSEProphet2 <- sqrt(MSEProphet2)
RMSEProphet2
```

```{r}
# Mean absolute error (MAE)
MAEProphet2 <- mean(abs(test_daily_no2$y - prediction_test_no2$yhat))
MAEProphet2
```

```{r}
# Mean absolute percentage error (MAPE)
MAPEProphet2 <- mean(abs(test_daily_no2$y - prediction_test_no2$yhat) / test_daily_no2$y)
MAPEProphet2
```
### 4. Hasil Prediksi Berdasarkan Variabel CO
## a. Membagi Data menjadi data latih dan data uji
```{r}
# membagi data berdasarkan variabel CO
train_data_index4 <- createDataPartition(datafinal$co, p=0.7, list = FALSE)
train_data_co <- datafinal[train_data_index4,]
test_data_co <- datafinal[-train_data_index4,]
```

```{r}
dim(train_data_co)
dim(test_data_co)
```

```{r}
head(train_data_co)
head(test_data_co)
```

```{r}
qplot(Tanggal, co, data = train_data_co,
      main = "Tingkat Polusi Partikel CO Data Latih")
```

```{r}
qplot(Tanggal, co, data = test_data_co,
      main = "Tingkat Polusi Partikel CO Uji")
```
## b. Mengelompokkan dan Menyiapkan data latih berdasarkan Variabel PM10
```{r}
daily_co <- train_data_co%>% 
  group_by(Tanggal) %>% 
  summarise( 
    tot_co=sum(co)
  )  
daily_co
```

```{r}
# Merubah format data kedalam ds dan y
train_daily_co <- daily_co %>% 
  rename(
    ds = "Tanggal",
    y = "tot_co"
    )
glimpse(train_daily_co)
```
## c. Membuat Model Prophet

```{r}
prophet_co <- prophet(daily.seasonality = TRUE, seasonality_prior_scale=0.1) %>% 
  fit.prophet(train_daily_co)
#prophet_co
```

## d. Melakukan Prediksi untuk 2 Tahun ke depan

```{r}
future_prophet_co<- make_future_dataframe(prophet_co, periods = 365*2, freq = "day")
glimpse(future_prophet_co)
```

## e. Menampilkan hasil prediksi

```{r}
# visualisasi hasil forecasting
forecast_co <- predict(prophet_co, future_prophet_co)
plot(prophet_co, forecast_co)
```

## f. Menampilkan hasil prediksi berdasarkan komponen

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(prophet_co, forecast_co) 
```

Berdasarkan gambar diatas bisa dilihat bahwa, tingkat partikel CO untuk 2 tahun kedepan trennya mengalami penurunan setiap tahunnya. Setiap tahun bisa dilihat ada peningkatan CO yang paling tinggi adalah di bulan Oktober s/d November.

## g. Forecast berdasarkan seasonality bulan

```{r}
# forecast berdasarkan seasionality month (bulan)
model_co_monthly <- prophet(changepoint.prior.scale = 0.05, 
                    yearly.seasonality = FALSE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 3) %>% 
  fit.prophet(train_daily_co) 
future_co_monthly <- make_future_dataframe(model_co_monthly, periods = 365) 
forecast_co_monthly <- predict(model_co_monthly, future_co_monthly) 
prophet_plot_components(model_co_monthly, forecast_co_monthly)
```

## h. Visualisasi Tren Peningkatan Partikel CO

```{r}
plot(model_co_monthly, forecast_co_monthly)
```

Berdasarkan gambar tersebut bisa dilihat bahwa tren penurunan jumlah partikel CO dibandingkan tahun sebelumnya.

## i. forecast berdasarkan seasionality penambahan holiday (hari libur)

```{r}
# Menetapkan hari libur mulai dari tahun 2016 sampai 2021, misal libur di hari natal 25 desember atau tahun baru setiap tanggal 31 desember
holiday <- 
  data.frame( 
    holiday = "newyeareve", 
    ds = dmy(c("31-12-2016","31-12-2017", "31-12-2018", "31-12-2019", "31-12-2020", "31-12-2021")), 
    lower_window = -6, 
    upper_window = 0 
  ) 
holiday 
```

```{r}
# visualisasi hasil forecast dengan penambahan efek holiday
model_co_holiday <- prophet(changepoint.prior.scale = 0.05, 
                    holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5) %>% 
  fit.prophet(train_daily_co) 
future_co_holiday <- make_future_dataframe(model_co_holiday, periods = 365*5) 
forecast_co_holiday <- predict(model_co_holiday, future_co_holiday) 
plot(model_co_holiday, forecast_co_holiday)
```

```{r}
# Melihat trend holiday effect dari perkiraan
prophet_plot_components(model_co_holiday, forecast_co_holiday)
```

## j. Melihat hasil perkiraan berdasarkan trend dan seonality

```{r}
forecast_co %>%
  select(ds, trend, weekly, yearly, yhat)
```

## k. Model fine Tuning untuk melihat trend liner dari permintaan

Ini digunakan untuk melihat trend perkiraan dengan bentuk lain yaitu dengan menambahkan changepoint

```{r}
plot(prophet_co, forecast_co) + 
  add_changepoints_to_plot(prophet_co, threshold = 0) 
```

## l. Menyiapkan data Test

```{r}
daily_co_test <- test_data_co %>% 
  group_by(Tanggal) %>% 
  summarise( 
    tot_co=sum(co)
  )  
daily_co_test
```

```{r}
# Merubah format data kedalam ds dan y
test_daily_co <- daily_co_test %>% 
  rename(
    ds = "Tanggal",
    y = "tot_co"
    )
glimpse(test_daily_co)
```

## m. Model Final

```{r}
# Menyiapkan model final
final_model_co <- prophet(changepoint.prior.scale = 0.05, 
                       yearly.seasonality = TRUE, 
                       holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5)  %>% 
  fit.prophet(train_daily_co) 
future_final_co <- make_future_dataframe(final_model_co, periods = nrow(test_daily_co) + 1) 
forecast_final_co <- predict(final_model_co, future_final_co) 
plot(final_model_co, forecast_final_co)
```

## n. Melakukan Prediksi dengan Data Uji

```{r}
# membuat prediksi untuk data uji
prediction_test_co <- predict(final_model_co, test_daily_co)
```


```{r}
# menampilkan hasil prediksi
plot(final_model_co, prediction_test_co)
```


```{r}
# menampilkan hasil prediksi
plot(final_model_co, prediction_test_co)
```

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(final_model_co, prediction_test_co)
```

```{r}
plot(final_model_co, forecast_final_co) + 
  geom_point(data = test_daily_co %>% 
               mutate(ds = as.POSIXct(ds)), aes(x=ds, y=y), color="tomato3")
```

Berdasarkan hasil diatas bisa disimpulkan bahwa model dapat memprediksi data uji dengan baik dan memperlihatkan bahwa prediksi untuk partikel CO pada data uji juga trennya terus menurun setiap tahunnya. Sehingga bisa dipastikan bahwa hasil prediksi model pada data latih sama dengan hasil prediksi pada data uji. Untuk memberikan gambaran seberapa baik model dan seberapa akurat hasil prediksi maka akan dilakukan evaluasi dengan beberapa matrik evaluasi yaitu: MSE, RSME, MAE, dan MAPE.

## o. Evaluasi Model (Model Performance)

```{r}
# Mean squared error (MSE)
MSEProphet3 <- mean((test_daily_co$y - prediction_test_co$yhat)^2)
MSEProphet3
```

```{r}
# Root mean squared error (RMSE)
RMSEProphet3 <- sqrt(MSEProphet3)
RMSEProphet3
```

```{r}
# Mean absolute error (MAE)
MAEProphet3 <- mean(abs(test_daily_co$y - prediction_test_co$yhat))
MAEProphet3
```

```{r}
# Mean absolute percentage error (MAPE)
MAPEProphet3 <- mean(abs(test_daily_co$y - prediction_test_co$yhat) / test_daily_co$y)
MAPEProphet3
```

### 5. Hasil Prediksi Berdasarkan Variabel O3
## a. Membagi Data menjadi data latih dan data uji
```{r}
# membagi data berdasarkan variabel O3
train_data_index5 <- createDataPartition(datafinal$o3, p=0.7, list = FALSE)
train_data_o3 <- datafinal[train_data_index5,]
test_data_o3<- datafinal[-train_data_index5,]
```


```{r}
dim(train_data_o3)
dim(test_data_o3)
```

```{r}
head(train_data_o3)
head(test_data_o3)
```

```{r}
qplot(Tanggal, o3, data = train_data_o3,
      main = "Tingkat Polusi Partikel O3 Data Latih")
```

```{r}
qplot(Tanggal, o3, data = test_data_o3,
      main = "Tingkat Polusi Partikel O3 Uji")
```
## b. Mengelompokkan dan Menyiapkan data latih berdasarkan Variabel PM10
```{r}
daily_o3 <- train_data_o3%>% 
  group_by(Tanggal) %>% 
  summarise( 
    tot_o3=sum(o3)
  )  
daily_o3
```

```{r}
# Merubah format data kedalam ds dan y
train_daily_o3 <- daily_o3 %>% 
  rename(
    ds = "Tanggal",
    y = "tot_o3"
    )
glimpse(train_daily_o3)
```
## c. Membuat Model Prophet

```{r}
prophet_o3 <- prophet(daily.seasonality = TRUE, seasonality_prior_scale=0.1) %>% 
  fit.prophet(train_daily_o3)
#prophet_o3
```

## d. Melakukan Prediksi untuk 2 Tahun ke depan

```{r}
future_prophet_o3<- make_future_dataframe(prophet_o3, periods = 365*2, freq = "day")
glimpse(future_prophet_o3)
```

## e. Menampilkan hasil prediksi

```{r}
# visualisasi hasil forecasting
forecast_o3 <- predict(prophet_o3, future_prophet_o3)
plot(prophet_o3, forecast_o3)
```

## f. Menampilkan hasil prediksi berdasarkan komponen

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(prophet_o3, forecast_o3) 
```

Berdasarkan gambar diatas bisa dilihat bahwa, tingkat partikel SO2 untuk 2 tahun kedepan trennya terus mengalami penurunan. Setiap tahun bisa dilihat ada peningkatan O3 yang paling tinggi adalah di bulan Juli s/d Agustus.

## g. Forecast berdasarkan seasonality bulan

```{r}
# forecast berdasarkan seasionality month (bulan)
model_o3_monthly <- prophet(changepoint.prior.scale = 0.05, 
                    yearly.seasonality = FALSE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 3) %>% 
  fit.prophet(train_daily_o3) 
future_o3_monthly <- make_future_dataframe(model_o3_monthly, periods = 365) 
forecast_o3_monthly <- predict(model_o3_monthly, future_o3_monthly) 
prophet_plot_components(model_o3_monthly, forecast_o3_monthly)
```

## h. Visualisasi Tren Peningkatan Partikel PM10

```{r}
plot(model_o3_monthly, forecast_o3_monthly)
```

Berdasarkan gambar tersebut bisa dilihat bahwa ada tren penurunan jumlah partikel Co dibandingkan tahun-tahun sebelumnya

## i. forecast berdasarkan seasionality penambahan holiday (hari libur)

```{r}
# Menetapkan hari libur mulai dari tahun 2016 sampai 2021, misal libur di hari natal 25 desember atau tahun baru setiap tanggal 31 desember
holiday <- 
  data.frame( 
    holiday = "newyeareve", 
    ds = dmy(c("31-12-2016","31-12-2017", "31-12-2018", "31-12-2019", "31-12-2020", "31-12-2021")), 
    lower_window = -6, 
    upper_window = 0 
  ) 
holiday 
```

```{r}
# visualisasi hasil forecast dengan penambahan efek holiday
model_o3_holiday <- prophet(changepoint.prior.scale = 0.05, 
                    holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5) %>% 
  fit.prophet(train_daily_o3) 
future_o3_holiday <- make_future_dataframe(model_o3_holiday, periods = 365*5) 
forecast_o3_holiday <- predict(model_o3_holiday, future_o3_holiday) 
plot(model_o3_holiday, forecast_o3_holiday)
```

```{r}
# Melihat trend holiday effect dari perkiraan
prophet_plot_components(model_o3_holiday, forecast_o3_holiday)
```

## j. Melihat hasil perkiraan berdasarkan trend dan seonality

```{r}
forecast_o3 %>%
  select(ds, trend, weekly, yearly, yhat)
```

## k. Model fine Tuning untuk melihat trend liner dari permintaan

Ini digunakan untuk melihat trend perkiraan dengan bentuk lain yaitu dengan menambahkan changepoint

```{r}
plot(prophet_o3, forecast_o3) + 
  add_changepoints_to_plot(prophet_o3, threshold = 0) 
```

## l. Menyiapkan data Test

```{r}
daily_o3_test <- test_data_o3%>% 
  group_by(Tanggal) %>% 
  summarise( 
    tot_o3=sum(o3)
  )  
daily_o3_test
```

```{r}
# Merubah format data kedalam ds dan y
test_daily_o3 <- daily_o3_test %>% 
  rename(
    ds = "Tanggal",
    y = "tot_o3"
    )
glimpse(test_daily_o3)
```

## m. Model Final

```{r}
# Menyiapkan model final
final_model_o3 <- prophet(changepoint.prior.scale = 0.05, 
                       yearly.seasonality = TRUE, 
                       holidays = holiday, daily.seasonality = TRUE) %>% 
  add_seasonality(name = "monthly", period = 30.5, fourier.order = 5)  %>% 
  fit.prophet(train_daily_o3) 
future_final_o3 <- make_future_dataframe(final_model_o3, periods = nrow(test_daily_o3) + 1) 
forecast_final_o3 <- predict(final_model_o3, future_final_o3) 
plot(final_model_o3, forecast_final_o3)
```

## n. Melakukan Prediksi dengan Data Uji

```{r}
# membuat prediksi untuk data uji
prediction_test_o3 <- predict(final_model_o3, test_daily_o3)
```


```{r}
# menampilkan hasil prediksi
plot(final_model_o3, prediction_test_o3)
```


```{r}
# menampilkan hasil prediksi
plot(final_model_o3, prediction_test_o3)
```

```{r}
# Visualisasi komponen dari model forecasting
prophet_plot_components(final_model_o3, prediction_test_o3)
```

```{r}
plot(final_model_o3, forecast_final_o3) + 
  geom_point(data = test_daily_o3 %>% 
               mutate(ds = as.POSIXct(ds)), aes(x=ds, y=y), color="tomato3")
```

Berdasarkan hasil diatas bisa disimpulkan bahwa model dapat memprediksi data uji dengan baik dan memperlihatkan bahwa prediksi untuk partikel O3 pada data uji juga trennya menurun. Sehingga bisa dipastikan bahwa hasil prediksi model pada data latih sama dengan hasil prediksi pada data uji. Untuk memberikan gambaran seberapa baik model dan seberapa akurat hasil prediksi maka akan dilakukan evaluasi dengan beberapa matrik evaluasi yaitu: MSE, RSME, MAE, dan MAPE.

## o. Evaluasi Model (Model Performance)

```{r}
# Mean squared error (MSE)
MSEProphet4 <- mean((test_daily_o3$y - prediction_test_o3$yhat)^2)
MSEProphet4
```

```{r}
# Root mean squared error (RMSE)
RMSEProphet4 <- sqrt(MSEProphet4)
RMSEProphet4
```

```{r}
# Mean absolute error (MAE)
MAEProphet4 <- mean(abs(test_daily_o3$y - prediction_test_o3$yhat))
MAEProphet4
```

```{r}
# Mean absolute percentage error (MAPE)
MAPEProphet4 <- mean(abs(test_daily_o3$y - prediction_test_o3$yhat) / test_daily_o3$y)
MAPEProphet4
```

## B. Model SVR

### 1. hasil prediksi berdasarkan Variabel SO2
## a. Membagi Data menjadi data latih dan data uji

```{r}
set.seed(123)
split_so2 <- createDataPartition(datafinal$so2, p = 0.7, list = FALSE)
data_train_svr1 <- datafinal[split_so2,]
data_test_svr1 <- datafinal[-split_so2,]
```

```{r}
dim(data_train_svr1)
dim(data_test_svr1)
```

```{r}
qplot(Tanggal, so2, data = data_train_svr1,
      main = "Tingkat Polusi Partikel SO2")
```

## b. Membuat Model SVR

```{r}
modelsvr_so2 <- svm(so2 ~ ., data = data_train_svr1, type = "eps-regression")
```

```{r}
# Melatih model
predic_svr_train1 <- predict(modelsvr_so2, data_train_svr1)
descr(predic_svr_train1)
```

```{r}
#Menambahkan kolom prediksi pada data pelatihan
data_train_svr1$predic_svr_train1 <- predic_svr_train1
```

```{r}
# Menampilkan plot hasil prediksi data pelatihan
ggplot(data_train_svr1, aes(x = so2, y = predic_svr_train1)) +
  geom_point(aes(x = Tanggal, y = so2, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr_train1, shape = 'Prediksi', color = 'Prediksi'), data=data_train_svr1, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel SO2", 
    subtitle = "Data Pelatihan", 
    caption = "",
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Black', 'Prediksi' = 'Red')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

## c. Memprediksi partikel SO2 pada data pengujian menggunakan model SVR

```{r}
# prediksi model
predic_svr1 <- predict(modelsvr_so2, data_test_svr1)
descr(predic_svr1)
```

```{r}
#Menambahkan kolom prediksi pada data test
data_test_svr1$predic_svr1 <- predic_svr1
colSums(is.na(data_test_svr1))
```

```{r}
head(data_test_svr1)
tail(data_test_svr1)
```

## d. Menampilkan plot hasil prediksi

```{r}
ggplot(data_test_svr1, aes(x = so2, y = predic_svr1)) +
  geom_point(aes(x = Tanggal, y = so2, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr1, shape = 'Prediksi', color = 'Prediksi'), data=data_test_svr1, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel SO2", 
    subtitle = "Data Pengujian", 
    caption = "", 
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Green', 'Prediksi' = 'Blue')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

```{r}
# Membandingkan nilai asli dengan nilai prediksi
data_test_svr_compare1 <- data_test_svr1 %>%
  mutate(Nilai_Asli = so2,
         Nilai_Prediksi = predic_svr1) %>%
  select(Nilai_Asli, Nilai_Prediksi) %>% 
  select(Nilai_Asli,Nilai_Prediksi)
# Tampilkan tabel
data_test_svr_compare1
```


## e. Evaluasi Model

```{r}
# Menggunakan library Metrics untuk evaluasi Model SVR
library(Metrics)
```

```{r}
# Menghitung MSE
MSE_svr1 <- mse(predic_svr1, data_test_svr1$so2)
MSE_svr1
```

```{r}
# Menghitung RMSE
RMSE_svr1 <- sqrt(MSE_svr1)
RMSE_svr1
```

```{r}
# Menghitung MAE
MAE_svr1 <- mae(predic_svr1, data_test_svr1$so2)
MAE_svr1
```

```{r}
# Menghitung MAPE
MAPE_svr1 <- mape(predic_svr1, data_test_svr1$so2)
MAPE_svr1
```
### 2. Membagi data berdasarkan Variabel PM10
## a. Membagi Data menjadi data latih dan data uji

```{r}
set.seed(123)
split_pm10 <- createDataPartition(datafinal$pm10, p = 0.7, list = FALSE)
data_train_svr2 <- datafinal[split_pm10,]
data_test_svr2 <- datafinal[-split_pm10,]
```

```{r}
dim(data_train_svr2)
dim(data_test_svr2)
```

```{r}
qplot(Tanggal, pm10, data = data_train_svr2,
      main = "Tingkat Polusi Partikel PM10")
```

## b. Membuat Model SVR

```{r}
modelsvr_pm10 <- svm(pm10 ~ ., data = data_train_svr2, type = "eps-regression")
```

```{r}
# Melatih model
predic_svr_train2 <- predict(modelsvr_pm10, data_train_svr2)
descr(predic_svr_train2)
```

```{r}
#Menambahkan kolom prediksi pada data pelatihan
data_train_svr2$predic_svr_train2 <- predic_svr_train2
```

```{r}
# Menampilkan plot hasil prediksi data pelatihan
ggplot(data_train_svr2, aes(x = pm10, y = predic_svr_train2)) +
  geom_point(aes(x = Tanggal, y = pm10, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr_train2, shape = 'Prediksi', color = 'Prediksi'), data=data_train_svr2, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel PM10", 
    subtitle = "Data Pelatihan", 
    caption = "",
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Black', 'Prediksi' = 'Red')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

## c. Memprediksi partikel PM10 pada data pengujian menggunakan model SVR

```{r}
# prediksi model
predic_svr2 <- predict(modelsvr_pm10, data_test_svr2)
descr(predic_svr2)
```

```{r}
#Menambahkan kolom prediksi pada data test
data_test_svr2$predic_svr2 <- predic_svr2
colSums(is.na(data_test_svr2))
```

```{r}
head(data_test_svr2)
tail(data_test_svr2)
```

## d. Menampilkan plot hasil prediksi

```{r}
ggplot(data_test_svr2, aes(x = pm10, y = predic_svr2)) +
  geom_point(aes(x = Tanggal, y = pm10, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr2, shape = 'Prediksi', color = 'Prediksi'), data=data_test_svr2, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel PM10", 
    subtitle = "Data Pengujian", 
    caption = "", 
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Green', 'Prediksi' = 'Blue')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

```{r}
# Membandingkan nilai asli dengan nilai prediksi
data_test_svr_compare2 <- data_test_svr2 %>%
  mutate(Nilai_Asli = pm10,
         Nilai_Prediksi = predic_svr2) %>%
  select(Nilai_Asli, Nilai_Prediksi)
# Tampilkan tabel
data_test_svr_compare2
```

## e. Evaluasi Model

```{r}
# Menggunakan library Metrics untuk evaluasi Model SVR
library(Metrics)
```

```{r}
# Menghitung MSE
MSE_svr2 <- mse(predic_svr2, data_test_svr2$pm10)
MSE_svr2
```

```{r}
# Menghitung RMSE
RMSE_svr2 <- sqrt(MSE_svr2)
RMSE_svr2
```

```{r}
# Menghitung MAE
MAE_svr2 <- mae(predic_svr2, data_test_svr2$pm10)
MAE_svr2
```

```{r}
# Menghitung MAPE
MAPE_svr2 <- mape(predic_svr2, data_test_svr2$pm10)
MAPE_svr2
```
### 3. Membagi data berdasarkan Variabel NO2
## a. Membagi Data menjadi data latih dan data uji

```{r}
set.seed(123)
split_no2 <- createDataPartition(datafinal$no2, p = 0.7, list = FALSE)
data_train_svr3 <- datafinal[split_no2,]
data_test_svr3 <- datafinal[-split_no2,]
```

```{r}
dim(data_train_svr3)
dim(data_test_svr3)
```

```{r}
qplot(Tanggal, no2, data = data_train_svr3,
      main = "Tingkat Polusi Partikel NO2")
```

## b. Membuat Model SVR

```{r}
modelsvr_no2 <- svm(no2 ~ ., data = data_train_svr3, type = "eps-regression")
```

```{r}
# Melatih model
predic_svr_train3 <- predict(modelsvr_no2, data_train_svr3)
descr(predic_svr_train3)
```

```{r}
#Menambahkan kolom prediksi pada data pelatihan
data_train_svr3$predic_svr_train3 <- predic_svr_train3
```

```{r}
# Menampilkan plot hasil prediksi data pelatihan
ggplot(data_train_svr3, aes(x = no2, y = predic_svr_train3)) +
  geom_point(aes(x = Tanggal, y = no2, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr_train3, shape = 'Prediksi', color = 'Prediksi'), data=data_train_svr3, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel NO2", 
    subtitle = "Data Pelatihan", 
    caption = "",
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Black', 'Prediksi' = 'Red')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

## c. Memprediksi partikel NO2 pada data pengujian menggunakan model SVR

```{r}
# prediksi model
predic_svr3 <- predict(modelsvr_no2, data_test_svr3)
descr(predic_svr3)
```

```{r}
#Menambahkan kolom prediksi pada data test
data_test_svr3$predic_svr3 <- predic_svr3
colSums(is.na(data_test_svr3))
```

```{r}
head(data_test_svr3)
tail(data_test_svr3)
```

## d. Menampilkan plot hasil prediksi

```{r}
ggplot(data_test_svr3, aes(x = no2, y = predic_svr3)) +
  geom_point(aes(x = Tanggal, y = no2, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr3, shape = 'Prediksi', color = 'Prediksi'), data=data_test_svr3, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel NO2", 
    subtitle = "Data Pengujian", 
    caption = "", 
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Green', 'Prediksi' = 'Blue')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

```{r}
# Membandingkan nilai asli dengan nilai prediksi
data_test_svr_compare3 <- data_test_svr3 %>%
  mutate(Nilai_Asli = no2,
         Nilai_Prediksi = predic_svr3) %>%
  select(Nilai_Asli, Nilai_Prediksi)
# Tampilkan tabel
data_test_svr_compare3
```

## e. Evaluasi Model

```{r}
# Menghitung MSE
MSE_svr3 <- mse(predic_svr3, data_test_svr3$no2)
MSE_svr3S
```

```{r}
# Menghitung RMSE
RMSE_svr3 <- sqrt(MSE_svr3)
RMSE_svr3
```

```{r}
# Menghitung MAE
MAE_svr3 <- mae(predic_svr3, data_test_svr3$no2)
MAE_svr3
```

```{r}
# Menghitung MAPE
MAPE_svr3 <- mape(predic_svr3, data_test_svr3$no2)
MAPE_svr3
```

### 4. Membagi data berdasarkan Variabel CO
## a. Membagi Data menjadi data latih dan data uji

```{r}
set.seed(123)
split_co <- createDataPartition(datafinal$co, p = 0.7, list = FALSE)
data_train_svr4 <- datafinal[split_co,]
data_test_svr4 <- datafinal[-split_co,]
```

```{r}
dim(data_train_svr4)
dim(data_test_svr4)
```

```{r}
qplot(Tanggal, co, data = data_train_svr4,
      main = "Tingkat Polusi Partikel CO")
```

## b. Membuat Model SVR

```{r}
modelsvr_co <- svm(co ~ ., data = data_train_svr4, type = "eps-regression")
```

```{r}
# Melatih model
predic_svr_train4 <- predict(modelsvr_co, data_train_svr4)
descr(predic_svr_train4)
```

```{r}
#Menambahkan kolom prediksi pada data pelatihan
data_train_svr4$predic_svr_train4 <- predic_svr_train4
```

```{r}
# Menampilkan plot hasil prediksi data pelatihan
ggplot(data_train_svr2, aes(x = co, y = predic_svr_train4)) +
  geom_point(aes(x = Tanggal, y = co, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr_train4, shape = 'Prediksi', color = 'Prediksi'), data=data_train_svr4, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel PM10", 
    subtitle = "Data Pelatihan", 
    caption = "",
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Black', 'Prediksi' = 'Red')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

## c. Memprediksi partikel PM10 pada data pengujian menggunakan model SVR

```{r}
# prediksi model
predic_svr4 <- predict(modelsvr_co, data_test_svr4)
descr(predic_svr4)
```

```{r}
#Menambahkan kolom prediksi pada data test
data_test_svr4$predic_svr4 <- predic_svr4
colSums(is.na(data_test_svr4))
```

```{r}
head(data_test_svr4)
tail(data_test_svr4)
```

## d. Menampilkan plot hasil prediksi

```{r}
ggplot(data_test_svr4, aes(x = co, y = predic_svr4)) +
  geom_point(aes(x = Tanggal, y = co, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr4, shape = 'Prediksi', color = 'Prediksi'), data=data_test_svr4, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel CO", 
    subtitle = "Data Pengujian", 
    caption = "", 
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Green', 'Prediksi' = 'Blue')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

```{r}
# Membandingkan nilai asli dengan nilai prediksi
data_test_svr_compare4 <- data_test_svr4 %>%
  mutate(Nilai_Asli = co,
         Nilai_Prediksi = predic_svr4) %>%
  select(Nilai_Asli, Nilai_Prediksi)
# Tampilkan tabel
data_test_svr_compare4
```

## e. Evaluasi Model

```{r}
# Menghitung MSE
MSE_svr4 <- mse(predic_svr4, data_test_svr4$co)
MSE_svr4
```

```{r}
# Menghitung RMSE
RMSE_svr4 <- sqrt(MSE_svr4)
RMSE_svr4
```

```{r}
# Menghitung MAE
MAE_svr4 <- mae(predic_svr4, data_test_svr4$co)
MAE_svr4
```

```{r}
# Menghitung MAPE
MAPE_svr4 <- mape(predic_svr4, data_test_svr4$co)
MAPE_svr4
```
### 5. Membagi data berdasarkan Variabel PM10
## a. Membagi Data menjadi data latih dan data uji

```{r}
set.seed(123)
split_o3 <- createDataPartition(datafinal$o3, p = 0.7, list = FALSE)
data_train_svr5 <- datafinal[split_o3,]
data_test_svr5 <- datafinal[-split_o3,]
```

```{r}
dim(data_train_svr5)
dim(data_test_svr5)
```

```{r}
qplot(Tanggal, o3, data = data_train_svr5,
      main = "Tingkat Polusi Partikel O3")
```

## b. Membuat Model SVR

```{r}
modelsvr_o3 <- svm(o3 ~ ., data = data_train_svr5, type = "eps-regression")
```

```{r}
# Melatih model
predic_svr_train5 <- predict(modelsvr_o3, data_train_svr5)
descr(predic_svr_train5)
```

```{r}
#Menambahkan kolom prediksi pada data pelatihan
data_train_svr5$predic_svr_train5 <- predic_svr_train5
```

```{r}
# Menampilkan plot hasil prediksi data pelatihan
ggplot(data_train_svr5, aes(x = o3, y = predic_svr_train5)) +
  geom_point(aes(x = Tanggal, y = o3, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr_train5, shape = 'Prediksi', color = 'Prediksi'), data=data_train_svr5, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel O3", 
    subtitle = "Data Pelatihan", 
    caption = "",
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Black', 'Prediksi' = 'Red')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

## c. Memprediksi partikel PM10 pada data pengujian menggunakan model SVR

```{r}
# prediksi model
predic_svr5 <- predict(modelsvr_o3, data_test_svr5)
descr(predic_svr5)
```

```{r}
#Menambahkan kolom prediksi pada data test
data_test_svr5$predic_svr5 <- predic_svr5
colSums(is.na(data_test_svr5))
```

```{r}
head(data_test_svr5)
tail(data_test_svr5)
```

## d. Menampilkan plot hasil prediksi

```{r}
ggplot(data_test_svr5, aes(x = o3, y = predic_svr5)) +
  geom_point(aes(x = Tanggal, y = o3, shape = 'Nilai Asli', color = 'Nilai Asli'), data=datafinal, size = 2) +
  geom_point(aes(x = Tanggal, y = predic_svr5, shape = 'Prediksi', color = 'Prediksi'), data=data_test_svr5, size = 1) +
  geom_abline(intercept = 0, slope = 1) +
  labs( 
    title = "Hasil Prediksi Model SVR untuk Partikel O3", 
    subtitle = "Data Pengujian", 
    caption = "", 
    x = "Tahun", 
    y = "Jumlah (μg/m3)" 
  ) +
  scale_shape_manual(name = "", values = c('Nilai Asli' = 16, 'Prediksi' = 15)) +
  scale_color_manual(name = "", values = c('Nilai Asli' = 'Green', 'Prediksi' = 'Blue')) +
  theme(legend.position = "bottom") +
  theme_minimal()
```

```{r}
# Membandingkan nilai asli dengan nilai prediksi
data_test_svr_compare5 <- data_test_svr5 %>%
  mutate(Nilai_Asli = o3,
         Nilai_Prediksi = predic_svr5) %>%
  select(Nilai_Asli, Nilai_Prediksi)
# Tampilkan tabel
data_test_svr_compare5
```

## e. Evaluasi Model

```{r}
# Menghitung MSE
MSE_svr5 <- mse(predic_svr5, data_test_svr5$o3)
MSE_svr5
```

```{r}
# Menghitung RMSE
RMSE_svr5 <- sqrt(MSE_svr5)
RMSE_svr5
```

```{r}
# Menghitung MAE
MAE_svr5 <- mae(predic_svr5, data_test_svr5$o3)
MAE_svr5
```

```{r}
# Menghitung MAPE
MAPE_svr5 <- mape(predic_svr5, data_test_svr5$o3)
MAPE_svr5
```

# 6. Interpret (Menampilkan Hasil Kinerja (Model)

```{r}
##Nilai Hasil Evaluasi Model Prophet
model_performance1 <- data.frame(
  Variabel=c("SO2","PM10","NO2","CO","O3"),
  Model = c("Prophet"),
  MSE = c(MSEProphet,MSEProphet1,MSEProphet2,MSEProphet3,MSEProphet4),
  RMSE = c(RMSEProphet,RMSEProphet1,RMSEProphet2,RMSEProphet3,RMSEProphet4),
  MAE = c(MAEProphet,MAEProphet1,MAEProphet2,MAEProphet3,MAEProphet4),
  MAPE = c(MAPEProphet,MAPEProphet1,MAPEProphet2,MAPEProphet3,MAPEProphet4),
  stringsAsFactors = FALSE)
```
```{r}
#simpan hasil model performance
model_performance1
write.csv (model_performance1, "modelperform.csv")
```
```{r}
model_performance2 <- data.frame(
  Variabel=c("SO2","PM10","NO2","CO","O3"),
  Model = c("SVR"),
  MSE = c(MSE_svr1,MSE_svr2,MSE_svr3,MSE_svr4,MSE_svr5),
  RMSE = c(RMSE_svr1,RMSE_svr2,RMSE_svr3,RMSE_svr4,RMSE_svr5),
  MAE = c(MAE_svr1,MAE_svr2,MAE_svr3,MAE_svr4,MAE_svr5),
  MAPE = c(MAPE_svr1,MAPE_svr2,MAPE_svr3,MAPE_svr4,MAPE_svr5),
  stringsAsFactors = FALSE)
```

```{r}
#simpan hasil model performance
model_performance2
write.csv (model_performance2, "modelperform.csv")
```

```{r}
##Nilai Hasil Evaluasi Model Prophet
model_performance3 <- data.frame(
  Variabel=c("SO2","PM10","NO2","CO","O3"),
  Model = c("Prophet","SVR"),
  MSE = c(MSEProphet,MSE_svr1,MSEProphet1,MSE_svr2,MSEProphet2,MSE_svr3,MSEProphet3,MSE_svr4,MSEProphet4,MSE_svr5),
  RMSE = c(RMSEProphet,RMSE_svr1,RMSEProphet1,RMSE_svr2,RMSEProphet2,RMSE_svr3,RMSEProphet3,RMSE_svr4,RMSEProphet4,RMSE_svr5),
  MAE = c(MAEProphet,MAE_svr1,MAEProphet1,MAE_svr2,MAEProphet2,MAE_svr3,MAEProphet3,MAE_svr4,MAEProphet4,MAE_svr5),
  MAPE = c(MAPEProphet,MAPE_svr1,MAPEProphet1,MAPE_svr2,MAPEProphet2,MAPE_svr3,MAPEProphet3,MAPE_svr4,MAPEProphet4,MAPE_svr5),
  stringsAsFactors = FALSE)
```
```{r}
#simpan hasil model performance
model_performance3
write.csv (model_performance3, "modelperform.csv")
```




